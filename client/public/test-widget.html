<!DOCTYPE html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Тест виджета чата</title>
    <style>
      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          sans-serif;
        max-width: 800px;
        margin: 50px auto;
        padding: 20px;
        background-color: #f5f5f5;
      }
      .container {
        background-color: white;
        padding: 30px;
        border-radius: 10px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      }
      h1 {
        color: #333;
        margin-bottom: 20px;
      }
      .info {
        background-color: #e3f2fd;
        padding: 15px;
        border-radius: 5px;
        margin-bottom: 20px;
      }
      .test-links {
        margin-top: 30px;
      }
      .test-links h3 {
        margin-bottom: 15px;
      }
      .test-links a {
        display: block;
        padding: 10px 15px;
        margin-bottom: 10px;
        background-color: #3b82f6;
        color: white;
        text-decoration: none;
        border-radius: 5px;
        transition: background-color 0.2s;
      }
      .test-links a:hover {
        background-color: #2563eb;
      }
      .test-links a.error {
        background-color: #ef4444;
      }
      .test-links a.error:hover {
        background-color: #dc2626;
      }
      code {
        background-color: #f1f5f9;
        padding: 2px 6px;
        border-radius: 3px;
        font-size: 14px;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>Тест проверки подключения виджета чата</h1>

      <div class="info">
        <p>
          <strong>Текущий Channel ID виджета:</strong>
          <code id="current-channel-id">загружается...</code>
        </p>
        <p><strong>URL параметр:</strong> <code id="url-param">нет</code></p>
      </div>

      <h2>Как это работает:</h2>
      <ol>
        <li>Виджет проверяет параметр <code>chat-widget</code> в URL</li>
        <li>Сравнивает его с текущим <code>channelId</code> виджета</li>
        <li>
          Показывает уведомление:
          <ul>
            <li>✓ Зеленое - если ID совпадают</li>
            <li>✗ Красное - если ID не совпадают</li>
          </ul>
        </li>
        <li>Уведомление автоматически исчезает через 5 секунд</li>
      </ol>

      <div class="test-links">
        <h3>Тестовые ссылки:</h3>
        <a href="?" id="link-no-param">Без параметра</a>
        <a href="#" id="link-correct"
          >С правильным Channel ID (будет заполнен автоматически)</a
        >
        <a href="?chat-widget=99999999" class="error"
          >С неправильным Channel ID (99999999)</a
        >
        <a href="?chat-widget=12345678" class="error"
          >С другим Channel ID (12345678)</a
        >
      </div>
    </div>

    <!-- Подключаем виджет чата -->
    <script src="chat-widget.js"></script>
    <script>
      // Инициализируем виджет с тестовым channelId
      const testChannelId = "1234567890";
      window.chatInit(testChannelId, {
        headerText: "Тестовый чат",
        position: "bottom-right",
      });

      // Обновляем информацию на странице
      document.addEventListener("DOMContentLoaded", function () {
        // Показываем текущий channel ID
        document.getElementById("current-channel-id").textContent =
          testChannelId;

        // Показываем URL параметр если есть
        const urlParams = new URLSearchParams(window.location.search);
        const urlChannelId = urlParams.get("chat-widget");
        if (urlChannelId) {
          document.getElementById("url-param").textContent = urlChannelId;
        }

        // Обновляем ссылку с правильным ID
        document.getElementById("link-correct").href =
          "?chat-widget=" + testChannelId;
        document.getElementById("link-correct").textContent =
          "С правильным Channel ID (" + testChannelId + ")";
      });
    </script>
  </body>
</html>
